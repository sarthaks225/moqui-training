<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-3.xsd">

<!-- Party service {create, retrieve, update, delete} -->

    <service verb="create" noun="Party" >
        <in-parameters>
            <parameter name="partyId" required="true"/>
            <parameter name="partyType" required="true"/>
            <parameter name="firstName" required="true"/>
            <parameter name="lastName" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="partyId"/>
        </out-parameters>
        <actions>
            <entity-make-value entity-name="Party" value-field="newParty"/>
            <entity-set value-field="newParty" include="all"/>
            <entity-create value-field="newParty" />
        </actions>
    </service>

    <service verb="find" noun="Party" >
        <in-parameters>
            <parameter name="partyId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="partyList" />
        </out-parameters>
        <actions>
            <entity-find entity-name="Party" list="partyList">
                <econdition field-name="partyId"/>
                <select-field field-name="partyId"/>
                <select-field field-name="firstName"/>
                <select-field field-name="lastName"/>
                <select-field field-name="partyType"/>
            </entity-find>
        </actions>
    </service>

    <service verb="update" noun="Party" >
        <in-parameters>
            <parameter name="partyId" required="true"/>
            <parameter name="partyType" required="true"/>
            <parameter name="firstName" required="true"/>
            <parameter name="lastName" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="partyId"/>
        </out-parameters>
        <actions>
            <entity-find-one entity-name="Party" value-field="party">
                <field-map field-name="partyId" from="context.partyId"/>
            </entity-find-one>
            <entity-set value-field="party" include="all"/>
            <entity-update value-field="party" />
        </actions>
    </service>

    <service verb="delete" noun="Party" >
        <in-parameters>
            <parameter name="partyId" />
        </in-parameters>
        <out-parameters>
            <parameter name="partyId" />
        </out-parameters>
        <actions>
            <entity-find-one entity-name="Party" value-field="isParty">
                <field-map field-name="partyId" from="context.partyId"/>
            </entity-find-one>
            <entity-find-one entity-name="OrderHeader" value-field="isOrderHeader">
                <field-map field-name="partyId" from="context.partyId" />
            </entity-find-one>
            <if condition="isOrderHeader != null">
                <entity-delete-related value-field="isOrderHeader" relationship-name="OrderItem" />
            </if>
            <if condition="isParty!=null">
                <entity-delete-related value-field="isParty" relationship-name="OrderHeader" />
                <entity-delete-related value-field="isParty" relationship-name="ContactMech" />
                <entity-delete value-field="isParty"/>
            </if>
        </actions>
    </service>

<!-- Contact service {create, retrieve, update, delete, }-->

    <service verb="create" noun="ContactMech"  >
        <in-parameters>
            <parameter name="contactMechId" required="true"/>
            <parameter name="partyId" required="false"/>
            <parameter name="streetAddress" required="true"/>
            <parameter name="city" required="true"/>
            <parameter name="state" required="true"/>
            <parameter name="postalCode" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="contactMechId" required="true"/>
        </out-parameters>
        <actions>
            <entity-make-value entity-name="ContactMech" value-field="newContactMech"/>
            <entity-set value-field="newContactMech" include="all"/>
            <entity-create value-field="newContactMech" />
        </actions>
    </service>

    <service verb="find" noun="ContactMech" >
        <in-parameters>
            <parameter name="partyId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="contactList" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="ContactMech" list="contactList">
                <econdition field-name="partyId"/>
                <select-field field-name="contactMechId"/>
                <select-field field-name="partyId"/>
                <select-field field-name="streetAddress"/>
                <select-field field-name="city"/>
                <select-field field-name="state"/>
                <select-field field-name="postalCode"/>
            </entity-find>
        </actions>
    </service>

    <service verb="update" noun="ContactMech" >
        <in-parameters>
            <parameter name="contactMechId" required="true"/>
            <parameter name="partyId" required="true"/>
            <parameter name="streetAddress" required="false"/>
            <parameter name="city" required="false"/>
            <parameter name="state" required="false"/>
            <parameter name="postalCode" required="false"/>
        </in-parameters>
        <out-parameters>
            <parameter name="contactMechId"/>
        </out-parameters>
        <actions>
            <entity-find-one entity-name="ContactMech" value-field="contactMech">
                <field-map field-name="contactMechId" from="contactMechId"/>
            </entity-find-one>
            <entity-set value-field="contactMech" include="all"/>
            <entity-update value-field="contactMech" />
        </actions>
    </service>

    <service verb="delete" noun="ContactMech" >
        <in-parameters>
            <parameter name="partyId" required="true"/>
            <parameter name="contactMechId"  required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="partyId" />
        </out-parameters>

        <actions>
            <entity-find-one entity-name="ContactMech" value-field="isContactMech">
                <field-map field-name="partyId" from="context.partyId" />
                <field-map field-name="contactMechId" from="context.contactMechId" />
            </entity-find-one>
            <if condition="isContactMech!=null">
                <entity-find-related value-field="isContactMech" relationship-name="OrderHeader" list="list" />
                <if condition="!list">
                    <entity-delete value-field="isContactMech" />
                </if>
                <else>
                    <return error="true" message="contact not deleted"/>
                </else>
            </if>
        </actions>
    </service>

<!-- Product service {create, retrieve, update, delete, }-->

    <service verb="create" noun="Product"  >
        <in-parameters>
            <parameter name="productId" required="true"/>
            <parameter name="productName" required="true"/>
            <parameter name="color" required="true"/>
            <parameter name="size" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="productId" required="true"/>
        </out-parameters>
        <actions>
            <entity-make-value entity-name="Product" value-field="newProduct"/>
            <entity-set value-field="newProduct" include="all"/>
            <entity-create value-field="newProduct" />
        </actions>
    </service>

    <service verb="find" noun="Product" >
        <in-parameters>
            <parameter name="productId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="productList" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="Product" list="productList">
                <econdition field-name="productId"/>
                <select-field field-name="productId"/>
                <select-field field-name="productName"/>
                <select-field field-name="color"/>
                <select-field field-name="size"/>
            </entity-find>
        </actions>
    </service>

    <service verb="update" noun="Product" >
        <in-parameters>
            <parameter name="productId" required="true"/>
            <parameter name="productName" required="true"/>
            <parameter name="color" required="false"/>
            <parameter name="size" required="false"/>
        </in-parameters>
        <out-parameters>
            <parameter name="productId"/>
        </out-parameters>
        <actions>
            <entity-find-one entity-name="Product" value-field="updateProduct">
                <field-map field-name="productId" from="context.productId"/>
            </entity-find-one>
            <entity-set value-field="updateProduct" include="all"/>
            <entity-update value-field="updateProduct"/>
        </actions>
    </service>
    
    <service verb="delete" noun="Product">
        <in-parameters>
            <parameter name="productId" />
        </in-parameters>
        <out-parameters>
            <parameter name="productId" />
        </out-parameters>
        <actions>
            <entity-find-one entity-name="Product" value-field="isProduct">
                <field-map field-name="productId" from="context.productId"/>
            </entity-find-one>
            <if condition="isProduct!=null">
                <entity-delete-related value-field="isProduct" relationship-name="OrderItem" />
                <entity-delete value-field="isProduct"/>
            </if>
        </actions>
    </service>

    <!-- OrderHeader service {create, retrieve, update, delete }-->

    <service verb="create" noun="OrderHeader" >
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderDate" required="true"/>
            <parameter name="partyId" required="true"/>
            <parameter name="shippingContactMechId" required="true"/>
            <parameter name="billingContactMechId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
        </out-parameters>
        <actions>
            <entity-make-value entity-name="OrderHeader" value-field="newOrder"/>
            <entity-set value-field="newOrder" include="all"/>
            <entity-create value-field="newOrder" />
        </actions>
    </service>

    <service verb="find" noun="OrderHeader" type="inline">
        <in-parameters>
            <parameter name="orderId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderHeaderList" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="OrderHeader" list="orderHeaderList">
                <econdition field-name="orderId"/>
                <select-field field-name="orderId"/>
                <select-field field-name="orderDate"/>
                <select-field field-name="partyId"/>
                <select-field field-name="shippingContactMechId"/>
                <select-field field-name="billingContactMechId"/>
            </entity-find>
        </actions>
    </service>

    <service verb="update" noun="OrderHeader" type="inline">
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderDate" required="true"/>
            <parameter name="partyId" required="true"/>
            <parameter name="shippingContactMechId" required="false"/>
            <parameter name="billingContactMechId" required="false"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId"/>
        </out-parameters>
        <actions>
            <entity-find-one entity-name="OrderHeader" value-field="updateOrder">
                <field-map field-name="orderId" from="context.orderId"/>
            </entity-find-one>
            <entity-set value-field="updateOrder" include="all"/>
            <entity-update value-field="updateOrder" />
        </actions>
    </service>

    <service verb="delete" noun="OrderHeader" type="inline">
        <in-parameters>
            <parameter name="orderId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" />
        </out-parameters>
        <actions>
            <entity-find-one entity-name="OrderHeader" value-field="isOrderHeader">
                <field-map field-name="orderId" from="orderId" />
            </entity-find-one>
            <entity-delete-related value-field="isOrderHeader" relationship-name="OrderItem"/>
            <entity-delete value-field="isOrderHeader"/>
        </actions>
    </service>

    <!-- OrderItems service {create, }-->
    <service verb="create" noun="OrderItem" >
        <in-parameters>
            <parameter name="orderItemSeqId" required="true"/>
            <parameter name="orderId" required="true"/>
            <parameter name="productId" required="true"/>
            <parameter name="quantity" required="true"/>
            <parameter name="status" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderItemSeqId" required="true"/>
        </out-parameters>
        <actions>
            <entity-make-value entity-name="OrderItem" value-field="newOrderItem"/>
            <entity-set value-field="newOrderItem" include="all"/>
            <entity-create value-field="newOrderItem" />
        </actions>
    </service>
</services>